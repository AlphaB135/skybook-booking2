<template>
      <div class="booking">
    <div class="cont">
      <h1>‡∏à‡∏≠‡∏á‡πÄ‡∏ó‡∏µ‡πà‡∏¢‡∏ß‡∏ö‡∏¥‡∏ô</h1>
      <p>‡∏Å‡∏£‡∏≠‡∏Å‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡πÅ‡∏•‡∏∞‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏ó‡∏µ‡πà‡∏¢‡∏ß‡∏ö‡∏¥‡∏ô‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£</p>

      <!-- ‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡πÄ‡∏ó‡∏µ‡πà‡∏¢‡∏ß‡∏ö‡∏¥‡∏ô -->
      <div>
        <!-- ‡∏£‡∏±‡∏ö event @search-flight ‡∏à‡∏≤‡∏Å BookingForm ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏°‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤ -->
        <BookingForm 
          @search-flight="handleSearch" 
          :origins="uniqueOrigins"
          :destinations="uniqueDestinations"
        />
      </div>

      <!-- ‡∏™‡πà‡∏ß‡∏ô‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡∏Å‡∏≤‡∏£‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤ (‡πÅ‡∏™‡∏î‡∏á‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•) -->
      <div v-if="hasSearched" class="mt-8">
        <div v-if="filteredFlights.length > 0">
          <FlightCard 
            :flights="filteredFlights"
            :data="formData"
            @select="$emit('select-flight', $event)"
          />
        </div>
        <div v-else class="text-center text-gray-500 py-8">
          ‡πÑ‡∏°‡πà‡∏û‡∏ö‡πÄ‡∏ó‡∏µ‡πà‡∏¢‡∏ß‡∏ö‡∏¥‡∏ô‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤
        </div>
      </div>
      
    </div>
  </div>
</template>

<script>
/**
 * ==============================================================================
 * üîÑ ‡∏´‡∏•‡∏±‡∏Å‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡πÑ‡∏´‡∏•‡∏Ç‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• (Data Flow) ‡∏´‡∏ô‡πâ‡∏≤ BookingComponent
 * ==============================================================================
 * 
 * 1. üì• ‡∏£‡∏±‡∏ö‡∏Ç‡∏≠‡∏á (INPUT):
 *    - ‡∏£‡∏±‡∏ö `allFlights` (‡πÄ‡∏ó‡∏µ‡πà‡∏¢‡∏ß‡∏ö‡∏¥‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î) ‡∏°‡∏≤‡∏à‡∏≤‡∏Å‡∏´‡∏ô‡πâ‡∏≤ Home (‡∏ï‡∏±‡∏ß‡πÅ‡∏°‡πà)
 * 
 * 2. ‚öôÔ∏è ‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏Ç‡∏≠‡∏á (PROCESS DOMAIN):
 *    - `uniqueOrigins` / `uniqueDestinations`: ‡∏™‡∏Å‡∏±‡∏î‡∏ä‡∏∑‡πà‡∏≠‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î‡∏≠‡∏≠‡∏Å‡∏°‡∏≤ ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏™‡πà‡∏á‡πÑ‡∏õ‡πÉ‡∏´‡πâ Dropdown ‡πÉ‡∏ô‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤
 * 
 * 3. üñ±Ô∏è ‡∏£‡∏≠‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á (EVENT LISTENER):
 *    - ‡∏£‡∏≠‡∏ü‡∏±‡∏á‡∏•‡∏π‡∏Å‡∏ô‡πâ‡∏≠‡∏á‡∏ä‡∏∑‡πà‡∏≠ <BookingForm> ‡∏™‡πà‡∏á‡∏™‡∏±‡∏ç‡∏ç‡∏≤‡∏ì `@search-flight` ‡∏°‡∏≤
 *    - ‡∏û‡∏≠‡∏Å‡∏î‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏õ‡∏∏‡πä‡∏ö -> ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô `handleSearch()`
 *    - ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡∏à‡∏∞‡∏Å‡∏£‡∏≠‡∏á `allFlights` ‡πÉ‡∏´‡πâ‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡πÅ‡∏Ñ‡πà‡∏ó‡∏µ‡πà‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç -> ‡πÄ‡∏Å‡πá‡∏ö‡πÉ‡∏™‡πà `filteredFlights`
 * 
 * 4. üì§ ‡∏™‡πà‡∏á‡∏Ç‡∏≠‡∏á‡∏ï‡πà‡∏≠ (OUTPUT to CHILD):
 *    - ‡πÄ‡∏≠‡∏≤ `filteredFlights` (‡∏ó‡∏µ‡πà‡∏Å‡∏£‡∏≠‡∏á‡πÅ‡∏•‡πâ‡∏ß) ‡∏™‡πà‡∏á‡πÑ‡∏õ‡πÉ‡∏´‡πâ‡∏•‡∏π‡∏Å‡∏ô‡πâ‡∏≠‡∏á‡∏ä‡∏∑‡πà‡∏≠ <FlightCard> ‡πÇ‡∏ä‡∏ß‡πå‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå
 * 
 * 5. üöÄ ‡∏à‡∏ö‡∏á‡∏≤‡∏ô (FINAL EMIT):
 *    - ‡πÄ‡∏°‡∏∑‡πà‡∏≠ User ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ï‡∏±‡πã‡∏ß‡πÉ‡∏ö‡πÑ‡∏´‡∏ô -> ‡∏™‡πà‡∏á‡∏™‡∏±‡∏ç‡∏ç‡∏≤‡∏ì `@select-flight` ‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡∏ö‡∏≠‡∏Å‡∏ï‡∏±‡∏ß‡πÅ‡∏°‡πà (Home) ‡∏ß‡πà‡∏≤ "‡πÑ‡∏î‡πâ‡πÅ‡∏•‡πâ‡∏ß‡∏ô‡∏∞!"
 */

import BookingForm from "./BookingForm.vue";
import FlightCard from "./FlightCard.vue"; 

export default { 
    name: "BookingComponent", 
    
    components: { 
        BookingForm,
        FlightCard 
    },

    // 1. [INPUT] ‡∏£‡∏±‡∏ö‡∏ï‡∏π‡πâ‡∏Ñ‡∏≠‡∏ô‡πÄ‡∏ó‡∏ô‡πÄ‡∏ô‡∏≠‡∏£‡πå‡πÄ‡∏ó‡∏µ‡πà‡∏¢‡∏ß‡∏ö‡∏¥‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏°‡∏≤‡∏à‡∏≤‡∏Å‡πÅ‡∏°‡πà
    props: {
        allFlights: {
            type: Array,
            default: () => []
        }
    },

    emits: ['select-flight'], 
    
    data() {
        return {
            formData: null,      // ‡πÄ‡∏Å‡πá‡∏ö‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç‡∏Å‡∏≤‡∏£‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤ (‡πÄ‡∏≠‡∏≤‡πÑ‡∏ß‡πâ‡∏™‡πà‡∏á‡∏ï‡πà‡∏≠‡πÉ‡∏´‡πâ FlightCard ‡πÉ‡∏ä‡πâ‡πÇ‡∏ä‡∏ß‡πå‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠)
            filteredFlights: [], // ‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÉ‡∏™‡πà "‡πÄ‡∏ó‡∏µ‡πà‡∏¢‡∏ß‡∏ö‡∏¥‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏à‡∏≠" (‡∏ï‡∏≠‡∏ô‡πÅ‡∏£‡∏Å‡∏ß‡πà‡∏≤‡∏á‡πÄ‡∏õ‡∏•‡πà‡∏≤)
            hasSearched: false   // ‡∏ò‡∏á‡πÄ‡∏ä‡πá‡∏Ñ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞: "‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏°‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏´‡∏£‡∏∑‡∏≠‡∏¢‡∏±‡∏á?" (‡∏ñ‡πâ‡∏≤‡∏¢‡∏±‡∏á ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÇ‡∏ä‡∏ß‡πå‡∏≠‡∏∞‡πÑ‡∏£)
        };
    },

    computed: {
        // 2. [PREPARE] ‡∏™‡∏Å‡∏±‡∏î‡∏ä‡∏∑‡πà‡∏≠‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î‡∏ï‡πâ‡∏ô‡∏ó‡∏≤‡∏á (‡πÑ‡∏°‡πà‡πÉ‡∏´‡πâ‡∏ã‡πâ‡∏≥) ‡∏™‡πà‡∏á‡πÉ‡∏´‡πâ‡∏ü‡∏≠‡∏£‡πå‡∏°
        uniqueOrigins() {
            const cities = this.allFlights.map(f => f.departure.airport)
            return [...new Set(cities)]
        },

        // 2. [PREPARE] ‡∏™‡∏Å‡∏±‡∏î‡∏ä‡∏∑‡πà‡∏≠‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î‡∏õ‡∏•‡∏≤‡∏¢‡∏ó‡∏≤‡∏á (‡πÑ‡∏°‡πà‡πÉ‡∏´‡πâ‡∏ã‡πâ‡∏≥) ‡∏™‡πà‡∏á‡πÉ‡∏´‡πâ‡∏ü‡∏≠‡∏£‡πå‡∏°
        uniqueDestinations() {
            const cities = this.allFlights.map(f => f.arrival.airport)
            return [...new Set(cities)]
        }
    },

    methods: {
        // 3. [ACTION] ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏•‡∏π‡∏Å‡∏ô‡πâ‡∏≠‡∏á BookingForm ‡∏ï‡∏∞‡πÇ‡∏Å‡∏ô‡∏ö‡∏≠‡∏Å‡∏ß‡πà‡∏≤ "‡∏´‡∏≤‡πÉ‡∏´‡πâ‡∏´‡∏ô‡πà‡∏≠‡∏¢!" (‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• criteria ‡∏°‡∏≤)
        handleSearch(criteria) {
            this.hasSearched = true;     // ‡∏õ‡∏±‡∏Å‡∏ò‡∏á‡∏ß‡πà‡∏≤ "‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡πÅ‡∏•‡πâ‡∏ß‡∏ô‡∏∞"
            this.formData = criteria;    // ‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡πÑ‡∏ß‡πâ
            
            console.log("‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤:", criteria);

            // 4. [LOGIC] ‡∏Å‡∏£‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• (Filter)
            this.filteredFlights = this.allFlights.filter(flight => {
                // ‡∏ñ‡πâ‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ï‡πâ‡∏ô‡∏ó‡∏≤‡∏á -> ‡∏ï‡πâ‡∏≠‡∏á‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ô (‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å ‡∏ñ‡∏∑‡∏≠‡∏ß‡πà‡∏≤‡∏ú‡πà‡∏≤‡∏ô)
                const matchFrom = criteria.from ? flight.departure.airport === criteria.from : true;
                
                // ‡∏ñ‡πâ‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏õ‡∏•‡∏≤‡∏¢‡∏ó‡∏≤‡∏á -> ‡∏ï‡πâ‡∏≠‡∏á‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ô
                const matchTo = criteria.to ? flight.arrival.airport === criteria.to : true;
                
                // ‡∏ï‡πâ‡∏≠‡∏á‡∏ú‡πà‡∏≤‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏Ñ‡∏π‡πà
                return matchFrom && matchTo;
            });

            // ‡∏Å‡∏£‡∏ì‡∏µ‡∏û‡∏¥‡πÄ‡∏®‡∏©: ‡∏ñ‡πâ‡∏≤User‡πÑ‡∏°‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏≠‡∏∞‡πÑ‡∏£‡πÄ‡∏•‡∏¢ ‡πÉ‡∏´‡πâ‡πÄ‡∏ó‡∏≠‡∏≠‡∏Å‡∏°‡∏≤‡πÉ‡∏´‡πâ‡∏´‡∏°‡∏î
            if (!criteria.from && !criteria.to) {
               this.filteredFlights = this.allFlights;
            }
        }
    }
};
</script>

<style scoped>
.booking {
  width: 100%;
  padding: 20px;
  font-family: "Roboto", sans-serif;
}
.cont {
  width: 90%;
  margin: 0 auto;
}
h1 {
  font-size: 30px;
  font-weight: bold;
  color: #1d4ed8;
  margin: 0;
}
p {
  font-size: 22px;
  color: #000000;
}
</style>
